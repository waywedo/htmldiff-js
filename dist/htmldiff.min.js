var e={d:(t,s)=>{for(var n in s)e.o(s,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:s[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{Z:()=>S});const s=0,n=1,r=2,i=3,o=4;class l{constructor(e,t,s){this.startInOld=e,this.startInNew=t,this.size=s}get endInOld(){return this.startInOld+this.size}get endInNew(){return this.startInNew+this.size}}const h=/^\s*<\/?[^>]+>\s*$/,d=/<[^\s>]+/,c=/^(\s|&nbsp;)+$/,a=/[\w#@]+/,u=["<img","<iframe","</iframe"];function p(e){return!u.some((t=>null!==e&&0===e.indexOf(t)))&&h.test(e)}function f(e,t,s){return`<${t} class="${s}">${e}</${t}>`}function w(e){return"<"===e}function g(e){return"&"===e}function I(e){return c.test(e)}function W(e){return a.test(e)}function O(e,t,s){return e.push(t),e.length>s&&e.shift(),e.length!==s?null:e.join("")}class x{constructor(e,t,s,n,r,i,o){this.oldWords=e,this.newWords=t,this.startInOld=s,this.endInOld=n,this.startInNew=r,this.endInNew=i,this.options=o}indexNewWords(){this.wordIndices=new Map;let e=[];for(let t=this.startInNew;t<this.endInNew;t++){let s=O(e,this.normalizeForIndex(this.newWords[t]),this.options.blockSize);null!==s&&(this.wordIndices.has(s)?this.wordIndices.get(s).push(t):this.wordIndices.set(s,[t]))}}normalizeForIndex(e){return e=function(e){return p(e)?function(e){return d.exec(e)[0]+(-1!==e.indexOf("/>",e.length-2)?"/>":">")}(e):e}(e),this.options.IgnoreWhiteSpaceDifferences&&I(e)?" ":e}findMatch(){if(this.indexNewWords(),this.removeRepeatingWords(),0===this.wordIndices.length)return null;let e=this.startInOld,t=this.startInNew,s=0,n=new Map;const r=this.options.blockSize;let i=[];for(let o=this.startInOld;o<this.endInOld;o++){let l=O(i,this.normalizeForIndex(this.oldWords[o]),r);if(null===l)continue;let h=new Map;this.wordIndices.has(l)?(this.wordIndices.get(l).forEach((i=>{let l=(n.has(i-1)?n.get(i-1):0)+1;h.set(i,l),l>s&&(e=o-l-r+2,t=i-l-r+2,s=l)})),n=h):n=h}return 0!==s?new l(e,t,s+r-1):null}removeRepeatingWords(){let e=this.newWords.length+this.options.repeatingWordsAccuracy,t=[];this.wordIndices.forEach(((s,n)=>{s.length>e&&t.push(n)})),t.forEach((e=>{this.wordIndices.delete(e)}))}}class m{constructor(e,t,s,n,r){this.action=e,this.startInOld=t,this.endInOld=s,this.startInNew=n,this.endInNew=r}}class N{constructor(){this.blockSize=0,this.repeatingWordsAccuracy=0,this.ignoreWhitespaceDifferences=!1}}const b=0,k=1,T=2,M=3;function v(e,t){let s={mode:b,currentWord:[],words:[]},n=function(e,t){let s=new Map;return null===t||t.forEach((t=>{let n;for(;null!==(n=t.exec(e));){if(s.has(n.index))throw new Error("One or more block expressions result in a text sequence that overlaps. Current expression: "+t.toString());s.set(n.index,n.index+n[0].length)}})),s}(e,t),r=!!n.size,i=!1,o=-1;for(let t=0;t<e.length;t++){var l=e[t];if(r){o===t&&(o=-1,i=!1);let e=0;if(n.has(t)&&(e=n.get(t),i=!0,o=e),i){s.currentWord.push(l),s.mode=b;continue}}switch(s.mode){case b:w(l)?y(s,"<",k):g(l)?y(s,l,M):I(l)?y(s,l,T):W(l)&&(0===s.currentWord.length||W(s.currentWord[s.currentWord.length-1]))?s.currentWord.push(l):y(s,l,b);break;case k:">"===l?(s.currentWord.push(l),s.words.push(s.currentWord.join("")),s.currentWord=[],s.mode=I(l)?T:b):s.currentWord.push(l);break;case T:w(l)?y(s,l,k):g(l)?y(s,l,M):I(l)?s.currentWord.push(l):y(s,l,b);break;case M:if(w(l))y(s,l,k);else if(I(l))y(s,l,T);else if(";"===l){let e=!0;if(0!==s.currentWord.length&&(s.currentWord.push(l),s.words.push(s.currentWord.join("")),s.words.length>2&&I(s.words[s.words.length-2])&&I(s.words[s.words.length-1]))){let t=s.words[s.words.length-2],n=s.words[s.words.length-1];s.words.splice(s.words.length-2,2),s.currentWord=[(t+n).split()],s.mode=T,e=!1}e&&(s.currentWord=[],s.mode=b)}else W(l)?s.currentWord.push(l):y(s,l,b)}}return 0!==s.currentWord.length&&s.words.push(s.currentWord.join("")),s.words}function y(e,t,s){0!==e.currentWord.length&&e.words.push(e.currentWord.join("")),e.currentWord=[t],e.mode=s}const E=new Map([["</strong>",0],["</em>",0],["</b>",0],["</i>",0],["</big>",0],["</small>",0],["</u>",0],["</sub>",0],["</strike>",0],["</s>",0],["</dfn>",0]]),j=/<((strong)|(b)|(i)|(dfn)|(em)|(big)|(small)|(u)|(sub)|(sup)|(strike)|(s))[>\s]+/gi;class D{constructor(e,t){this.content=[],this.newText=t,this.oldText=e,this.specialTagDiffStack=[],this.newWords=[],this.oldWords=[],this.matchGranularity=0,this.blockExpressions=[],this.repeatingWordsAccuracy=1,this.ignoreWhiteSpaceDifferences=!1,this.orphanMatchThreshold=0}build(){return this.oldText===this.newText||void 0===this.oldText||null===this.oldText?this.newText:void 0===this.newText||null===this.newText?this.oldText:(this.splitInputsIntoWords(),this.matchGranularity=Math.min(4,this.oldWords.length,this.newWords.length),this.operations().forEach((e=>{this.performOperation(e)})),this.content.join(""))}addBlockExpression(e){this.blockExpressions.push(e)}splitInputsIntoWords(){this.oldWords=v(this.oldText,this.blockExpressions),this.oldText=null,this.newWords=v(this.newText,this.blockExpressions),this.newText=null}performOperation(e){switch(e.action){case s:this.processEqualOperation(e);break;case n:this.processDeleteOperation(e,"diffdel");break;case r:this.processInsertOperation(e,"diffins");break;case i:break;case o:this.processReplaceOperation(e)}}processReplaceOperation(e){this.processDeleteOperation(e,"diffmod"),this.processInsertOperation(e,"diffmod")}processInsertOperation(e,t){let s=this.newWords.filter(((t,s)=>s>=e.startInNew&&s<e.endInNew));this.insertTag("ins",t,s)}processDeleteOperation(e,t){let s=this.oldWords.filter(((t,s)=>s>=e.startInOld&&s<e.endInOld));this.insertTag("del",t,s)}processEqualOperation(e){let t=this.newWords.filter(((t,s)=>s>=e.startInNew&&s<e.endInNew));this.content.push(t.join(""))}insertTag(e,t,s){for(;s.length;){let n=this.extractConsecutiveWords(s,(e=>!p(e))),r="",i=!1;if(0!==n.length){let s=f(n.join(""),e,t);this.content.push(s)}else{if(j.test(s[0])){let t=s[0].match(j);if(t="<"+t[0].replace(/(<|>| )/g,"")+">",this.specialTagDiffStack.push(t),r='<ins class="mod">',"del"===e)for(s.shift();s.length>0&&j.test(s[0]);)s.shift()}else if(E.has(s[0])){let t=0===this.specialTagDiffStack.length?null:this.specialTagDiffStack.pop();if(null===t||t!==s[s.length-1].replace(/\//g,"")||(r="</ins>",i=!0),"del"===e)for(s.shift();s.length>0&&E.has(s[0]);)s.shift()}if(0===s.length&&0===r.length)break;i?this.content.push(r+this.extractConsecutiveWords(s,p).join("")):this.content.push(this.extractConsecutiveWords(s,p).join("")+r)}}}extractConsecutiveWords(e,t){let s=null;for(let n=0;n<e.length;n++){let r=e[n];if(0===n&&" "===r&&(e[n]="&nbsp;"),!t(r)){s=n;break}}if(null!==s){let t=e.filter(((e,t)=>t>=0&&t<s));return s>0&&e.splice(0,s),t}{let t=e.filter(((t,s)=>s>=0&&s<e.length));return e.splice(0,e.length),t}}operations(){let e=0,t=0,h=[],d=this.matchingBlocks();d.push(new l(this.oldWords.length,this.newWords.length,0));let c,a,u=this.removeOrphans(d);for(;!(c=u.next()).done;){a=c.value;let l,d=e===a.startInOld,u=t===a.startInNew;l=d||u?d&&!u?r:d?i:n:o,l!==i&&h.push(new m(l,e,a.startInOld,t,a.startInNew)),0!==a.length&&h.push(new m(s,a.startInOld,a.endInOld,a.startInNew,a.endInNew)),e=a.endInOld,t=a.endInNew}return h}*removeOrphans(e){let t=null,s=null;for(let n=0;n<e.length;n++){const r=e[n];if(null===s){t=new l(0,0,0),s=r;continue}if(t.endInOld===s.startInOld&&t.endInNew===s.startInNew||s.endInOld===r.startInOld&&s.endInNew===r.startInNew){yield s,t=s,s=r;continue}let i=(e,t)=>e+t.length,o=this.oldWords.slice(t.endInOld,r.startInOld).reduce(i,0),h=this.newWords.slice(t.endInNew,r.startInNew).reduce(i,0);this.newWords.slice(s.startInNew,s.endInNew).reduce(i,0)>Math.max(o,h)*this.orphanMatchThreshold&&(yield s),t=s,s=r}yield s}matchingBlocks(){let e=[];return this.findMatchingBlocks(0,this.oldWords.length,0,this.newWords.length,e),e}findMatchingBlocks(e,t,s,n,r){let i=this.findMatch(e,t,s,n);null!==i&&(e<i.startInOld&&s<i.startInNew&&this.findMatchingBlocks(e,i.startInOld,s,i.startInNew,r),r.push(i),i.endInOld<t&&i.endInNew<n&&this.findMatchingBlocks(i.endInOld,t,i.endInNew,n,r))}findMatch(e,t,s,n){for(let r=this.matchGranularity;r>0;r--){let i=new N;i.blockSize=r,i.repeatingWordsAccuracy=this.repeatingWordsAccuracy,i.ignoreWhitespaceDifferences=this.ignoreWhiteSpaceDifferences;let o=new x(this.oldWords,this.newWords,e,t,s,n,i).findMatch();if(null!==o)return o}return null}}D.execute=function(e,t){return new D(e,t).build()};const S=D;var z=t.Z;export{z as default};